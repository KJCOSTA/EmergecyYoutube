generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Project {
  id                   String                @id @default(cuid())
  name                 String
  topic                String
  status               ProjectStatus         @default(PENDING)
  autoMode             Boolean               @default(false)
  mode                 String                @default("FAST")
  tagsFoco             String[]
  linkConcorrente      String?
  transcricao          String?               @db.Text
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  render               Render?
  research             Research?
  script               Script?
  storyboard           Storyboard?
  upload               Upload?
  workflowState        WorkflowState?
  youtubeStudioData    YouTubeStudioData?
  competitorAnalysis   CompetitorAnalysis?

  @@index([status])
  @@index([createdAt])
  @@index([mode])
}

model Research {
  id               String   @id @default(cuid())
  projectId        String   @unique
  internalAnalysis Json?
  externalAnalysis Json?
  summary          String?
  status           String   @default("pending")
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  project          Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model Script {
  id         String    @id @default(cuid())
  projectId  String    @unique
  title      String?
  content    String?
  sections   Json?
  metadata   Json?
  approved   Boolean   @default(false)
  approvedAt DateTime?
  feedback   String?
  status     String    @default("pending")
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  project    Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model Storyboard {
  id        String   @id @default(cuid())
  projectId String   @unique
  scenes    Json?
  status    String   @default("pending")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model Render {
  id               String    @id @default(cuid())
  projectId        String    @unique
  externalJobId    String?
  videoUrl         String?
  thumbnailUrl     String?
  duration         Int?
  status           String    @default("pending")
  error            String?
  videoPreviewUrl  String?
  previewApproved  Boolean   @default(false)
  previewApprovedAt DateTime?
  previewNotes     String?   @db.Text
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  project          Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model Upload {
  id             String    @id @default(cuid())
  projectId      String    @unique
  youtubeVideoId String?
  youtubeUrl     String?
  title          String?
  description    String?
  tags           Json?
  publishedAt    DateTime?
  status         String    @default("pending")
  error          String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  project        Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model WorkflowState {
  id                    String    @id @default(cuid())
  projectId             String    @unique
  currentStep           String    @default("init")
  inngestRunId          String?
  approvalToken         String?   @unique
  researchStartedAt     DateTime?
  researchCompletedAt   DateTime?
  scriptStartedAt       DateTime?
  scriptCompletedAt     DateTime?
  approvalSentAt        DateTime?
  approvedAt            DateTime?
  storyboardStartedAt   DateTime?
  storyboardCompletedAt DateTime?
  renderStartedAt       DateTime?
  renderCompletedAt     DateTime?
  uploadStartedAt       DateTime?
  uploadCompletedAt     DateTime?
  error                 String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  project               Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([approvalToken])
}

model UserSettings {
  id                String   @id @default(cuid())
  email             String   @unique
  notificationEmail String?
  autoApprove       Boolean  @default(false)
  maxRetries        Int      @default(3)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model YouTubeStudioData {
  id          String   @id @default(cuid())
  projectId   String   @unique
  rawData     Json
  totalVideos Int
  analyzedAt  DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model CompetitorAnalysis {
  id               String   @id @default(cuid())
  projectId        String   @unique
  videoUrl         String
  videoTitle       String?
  videoDescription String?  @db.Text
  videoTags        String[]
  analyzedAt       DateTime @default(now())
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  project          Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model TestMessage {
  id        String   @id @default(cuid())
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum ProjectStatus {
  PENDING
  RESEARCHING
  SCRIPTING
  AWAITING_APPROVAL
  APPROVED
  STORYBOARDING
  RENDERING
  UPLOADING
  COMPLETED
  FAILED
}
